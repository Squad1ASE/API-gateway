<html>
  <head>
    <title>Create Restaurant</title>

    {# Import JQuery #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script>
      //Add a new subform
      function addSubform() {
        var $templateForm = $('#subform-_-form');

        if (!$templateForm) {
          console.log('[ERROR] Cannot find template');
          return;
        }

        // Get Last index
        var $lastForm = $('.subform').last();

        var newIndex = 0;
        if ($lastForm.length > 0) {
          newIndex = parseInt($lastForm.data('index')) + 1;
        }

        // Maximum of 100 subforms
        if (newIndex >= 100) {
          console.log('[WARNING] Reached maximum number of elements');
          return;
        }

        // Add elements
        var $newForm = $templateForm.clone();

        $newForm.attr('id', $newForm.attr('id').replace('_', newIndex));
        $newForm.data('index', newIndex);

        $newForm.find('label').each(function(idx) {
          var $item = $(this);
          $item.attr('for', $item.attr('for').replace('_', newIndex));
        });

        $newForm.find('input').each(function(idx) {
          var $item = $(this);

          $item.attr('id', $item.attr('id').replace('_', newIndex));
          $item.attr('name', $item.attr('name').replace('_', newIndex));
        });

        // Append
        $('#subforms-subforms-container').append($newForm);
        $newForm.addClass('subform');
        $newForm.removeClass('is-hidden');
      }

      $(document).ready(function() {
        addSubform();
        addSubform();
        addSubform();
        addSubform();
      });
    </script>

    <style>
      .is-hidden {
        display: none;
      }
    </style>
    
  </head>

 <body>
  <form action="" method="POST">
    {{ form.hidden_tag() }}

    {# subforms #}
    <div id="subforms-subforms-container">
      {% for subform in form.guest %}
        <div id="subform-{{ loop.index0 }}-form" class="subform" data-index="{{ loop.index0 }}">
          {{ subform.email.label }}
          {{ subform.email }}
        </div>
        
              {% for e in subform.email.errors %}
                <p class="help-block">{{ field.label }}: {{ e }}</p>
              {% endfor %}
   
      {% endfor %} 
    </div>

    <p>
    <input type=submit value="Submit">
  </form>



  {# Subform template #}
  <div id="subform-_-form" class="is-hidden" data-index="_">
    <label for="subforms-_-email">email</label>
    <input id="subforms-_-email" name="subforms-_-email" type="text">
  </div>

 </body>
</html>